import{_ as s,o as a,c as e,V as o}from"./chunks/framework.7ae304b1.js";const n="/assets/folders.8c817df9.png",F=JSON.parse('{"title":"URI","description":"","frontmatter":{},"headers":[],"relativePath":"fs/uri.md","filePath":"fs/uri.md"}'),t={name:"fs/uri.md"},l=o(`<h1 id="uri" tabindex="-1">URI <a class="header-anchor" href="#uri" aria-label="Permalink to &quot;URI&quot;">​</a></h1><h2 id="what-is-a-pinokio-uri" tabindex="-1">What is a Pinokio URI? <a class="header-anchor" href="#what-is-a-pinokio-uri" aria-label="Permalink to &quot;What is a Pinokio URI?&quot;">​</a></h2><h3 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">​</a></h3><p>Normally when we talk about APIs, we think of <strong>remote web servers that can be configured to expose one or more public routes</strong>, to which you can make requests.</p><p>However, Pinokio API was designed with a unique set of assumptions:</p><ol><li><strong>Local First:</strong> Unlike traditional APIs that assume remote execution, Pinokio assumes the primary use case is interacting with the local machine to carry out tasks. This &quot;local first&quot; assumption is important for running AI tasks with privacy and without censorship.</li><li><strong>Zero Configuration:</strong> APIs should require zero configuration, and should &quot;just work&quot; out of the box.</li><li><strong>Globally unique resource identifiers for locally hosted APIs:</strong> This sounds like an oxymoron, but it is a unique challenge for autonomous AI engines, because while we assume that the actual task execution will happen locally, there needs to be some way to globally address these locally hosted endpoints. An example solution adopted by Pinokio is to use <a href="#http-path">public git URIs for calling APIs</a>.</li></ol><h3 id="implementation" tabindex="-1">Implementation <a class="header-anchor" href="#implementation" aria-label="Permalink to &quot;Implementation&quot;">​</a></h3><ol><li><strong>JSON RPC:</strong> All API requests are <a href="https://www.jsonrpc.org/specification" target="_blank" rel="noreferrer">JSON-RPC</a> calls (instead of <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noreferrer">REST</a> based)</li><li><strong>Automatic 1:1 mapping to local file paths:</strong> Unlike traditional APIs where you can only make requests to manually configured routes, Pinokio automatically creates an endpoint for EVERY file path under the Pinokio file system.</li><li><strong>Convention over Configuration:</strong> To automatically map JSON-RPC calls to local file paths, the Pinokio URI framework has a convention you can follow instead of manually specifying exposed routes.</li></ol><p>Basically, Pinokio API URIs are unique resource identifiers that automatically map to locally installed folders via HTTP.</p><h2 id="instant-uri" tabindex="-1">Instant URI <a class="header-anchor" href="#instant-uri" aria-label="Permalink to &quot;Instant URI&quot;">​</a></h2><h3 id="convention-over-configuration" tabindex="-1">Convention over Configuration <a class="header-anchor" href="#convention-over-configuration" aria-label="Permalink to &quot;Convention over Configuration&quot;">​</a></h3><p>Similar to how <a href="https://nextjs.org/docs/pages/building-your-application/routing" target="_blank" rel="noreferrer">next.js automatically sets up routes based on convention</a>, Pinokio lets you simply place your workspace folders under the <code>~/pinokio/api</code> top level folder, and the files inside your workspace folders will be instantly made available for API reqeusts, each available at URIs based on the file and folder paths.</p><h2 id="uri-types" tabindex="-1">URI Types <a class="header-anchor" href="#uri-types" aria-label="Permalink to &quot;URI Types&quot;">​</a></h2><p>When making an API request to a Pinokio engine, you can use any of the following 3 URI schemes:</p><ol start="2"><li>Relative path</li><li>HTTP path</li></ol><p>Note that all of these URI schemes resolve to a local file path (even when using the HTTP path option).</p><h3 id="relative-path" tabindex="-1">Relative Path <a class="header-anchor" href="#relative-path" aria-label="Permalink to &quot;Relative Path&quot;">​</a></h3><p>A URI can be a file path. Let&#39;s imagine an example project:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">~/pinokio</span></span>
<span class="line"><span style="color:#A6ACCD;">  /test</span></span>
<span class="line"><span style="color:#A6ACCD;">    run.json</span></span>
<span class="line"><span style="color:#A6ACCD;">    /bin</span></span>
<span class="line"><span style="color:#A6ACCD;">      install.json</span></span></code></pre></div><p>Where the <code>run.json</code> script looks like this:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">run</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">uri</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./bin/install.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">method</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">run</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">params</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      ... </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Note that the relative path <code>./bin/install.json</code> will be resolved against the path of the calling script (<code>run.json</code>).</p><h3 id="http-path" tabindex="-1">HTTP Path <a class="header-anchor" href="#http-path" aria-label="Permalink to &quot;HTTP Path&quot;">​</a></h3><p>An HTTP path exists ONLY for the folders you downloaded from a remote git repository.</p><h4 id="spec" tabindex="-1">Spec <a class="header-anchor" href="#spec" aria-label="Permalink to &quot;Spec&quot;">​</a></h4><p>The HTTP path is equivalent to the remote git URI, followed by the relative path within the git repository. It takes the following format:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;remote git URI&gt;/&lt;relative path&gt;</span></span></code></pre></div><p>For example, to reference a file at <code>index.js</code> inside the <a href="https://github.com/cocktailpeanut/llama.git" target="_blank" rel="noreferrer">https://github.com/cocktailpeanut/llama.git</a> git repository, the HTTP path would look like:</p><p><a href="https://github.com/cocktailpeanut/llama.git/index.js" target="_blank" rel="noreferrer">https://github.com/cocktailpeanut/llama.git/index.js</a></p><h4 id="how-it-works" tabindex="-1">How it works <a class="header-anchor" href="#how-it-works" aria-label="Permalink to &quot;How it works&quot;">​</a></h4><p>Although the URL looks like a typical HTTP url, it&#39;s important to note that the you are not actually making an API request to <a href="https://github.com/cocktailpeanut/llama.git/index.js" target="_blank" rel="noreferrer">https://github.com/cocktailpeanut/llama.git/index.js</a></p><ol><li>The URI is just a unique identifier used to identify the endpoint and the method to call</li><li>The <code>remote git URI</code> and <code>relative path</code> combination is used to uniquely identify where the API files exist on your machine.</li></ol><h4 id="where-the-files-are-stored" tabindex="-1">Where the files are stored <a class="header-anchor" href="#where-the-files-are-stored" aria-label="Permalink to &quot;Where the files are stored&quot;">​</a></h4><p>When you download an API from a git repository, Pinokio stores them under the <strong>hex version of the remote git URI</strong>.</p><p>For example, if the remote git URI you downloaded were <a href="https://github.com/cocktailpeanut/llama.git" target="_blank" rel="noreferrer">https://github.com/cocktailpeanut/llama.git</a> - Pinokio automatically creates a folder named <code>0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974</code> (This is the hex version of the URI) and downloads the remote git repository to that folder.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">~</span></span>
<span class="line"><span style="color:#A6ACCD;">  /pinokio</span></span>
<span class="line"><span style="color:#A6ACCD;">    /api</span></span>
<span class="line"><span style="color:#A6ACCD;">      /0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974</span></span></code></pre></div><p>Note that Pinokio automatically generates these folder names when you download APIs from git repositories, but when you&#39;re building your own app or api locally, you can name the folders whatever you want:</p><p><img src="`+n+`" alt="folders.png"></p><p>In above example, the first 4 folders with hex names are the downloaded APIs, whereas the next 2 (<strong>helloworld</strong> and <strong>test</strong>) are locally created folders.</p><h4 id="rules" tabindex="-1">Rules <a class="header-anchor" href="#rules" aria-label="Permalink to &quot;Rules&quot;">​</a></h4><p>Some rules:</p><ol><li>The <code>&lt;remote git URI&gt;</code> must end with <code>.git</code> (This is the standard way to reference git repositories)</li><li>The URL info is derived from the <code>.git/config</code> file within the downloaded repository.</li></ol><h4 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>This section will explain how the URI to local path resolution is actually carried out.</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">run</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">uri</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://github.com/cocktailpeanut/llama.git/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">method</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">run</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">params</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">message</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">p</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">### Instruction</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">Write a brief controversial opinion.</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">### Response</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">m</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../models/stable-vicuna/13b_q4_0.bin</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">256</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>In above example,</p><ol><li>The <code>https://github.com/cocktailpeanut/llama.git</code> part is the <code>&lt;remote git URI&gt;</code></li><li>The <code>index.js</code> part is the <code>&lt;relative path&gt;</code></li></ol><p>Resolution algorithm:</p><ol><li><strong>Begin URI parsing:</strong> Pinokio sees the uri <code>https://github.com/cocktailpeanut/llama.git/index.js</code></li><li><strong>Git uri extraction:</strong> the git repository uri is extracted from the full uri: <code>https://github.com/cocktailpeanut/llama.git</code></li><li><strong>Git config match:</strong> Pinokio checks if there is any top level folder under <code>~/pinokio/api</code> whose <code>.git/config</code> includes a matching remote URL</li><li><strong>Endpoint resolution:</strong> If there&#39;s a match (let&#39;s say it finds one at <code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974</code>), the resolution is complete, and the request is routed to the module inside the matched local folder (<code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974</code>).</li><li><strong>Route resolution:</strong> Now that the endpoint has been resolved, Pinokio looks at the <code>&lt;relative path&gt;</code> part of the full URI. In this case it&#39;s <code>index.js</code>. Pinokio takes the resolved endpoint path from the previous step (<code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974</code>) and resolves the rest of the file path <code>index.js</code>, and ends up with the full local path <code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974/index.js</code>.</li><li><strong>Method resolution:</strong> Pinokio then looks at the JavaScript class file <code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974/index.js</code> and finds the method <code>run</code></li><li><strong>Method Execution:</strong> Now that Pinokio knows which method inside which file needs to be executed, the only thing left is to actually execute the method by passing the <code>params</code> attribute.</li></ol><p>The <code>~/pinokio/api/0x68747470733a2f2f6769746875622e636f6d2f636f636b7461696c7065616e75742f6c6c616d612e676974/index.js</code> must follow the <a href="./../apps/api.html#api-framework">API framework convention</a>, and may look something like this:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Llama</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">ondata</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">kernel</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// do stuff with the request.params</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Llama</span></span></code></pre></div><p>The <code>request</code> parameter will contain:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  uri</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> &#39;https:</span><span style="color:#676E95;font-style:italic;">//github.com/malfunctionize/llama.git/index.js&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  method: &#39;run&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  params</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    message</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      p</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">### Instruction</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">Write a brief controversial opinion.</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">### Response</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      m</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> &#39;../models/stable-vicuna/</span><span style="color:#F78C6C;">13</span><span style="color:#A6ACCD;">b_q</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">_</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.bin&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      n</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">256</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  dirname</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> &#39;/Users/x/pinokio/api/llama&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  cwd</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> &#39;/Users/x/pinokio/api/llama/example&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> &#39;https:</span><span style="color:#676E95;font-style:italic;">//github.com/malfunctionize/llama.git/example/stable-vicuna-13b-q4_0.json&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  current: </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  next</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ol><li><code>uri</code>: the full endpoint URI from the <strong>begin URI parsing</strong> step.</li><li><code>method</code>: the RPC method passed in.</li><li><code>params</code>: the RPC params passed in.</li><li><code>dirname</code>: the resolved local path from the <strong>endpoint resolution</strong> step. This is the path under which the resolved module exists</li><li><code>cwd</code>: the current execution path. This is the folder that contains the script that is running currently.</li><li><code>root</code>: the full path for the script file that is currently running.</li><li><code>current</code>: The current instruction index within the <code>run</code> array. In this case it&#39;s 0 since it&#39;s the first instruction in the <code>run</code> array.</li><li><code>next</code>: The next instruction index to be executed after the current request ends. In this case it&#39;s <code>null</code> since there is only one item in the <code>run</code> array (the current instruction), and <code>null</code> means the program will halt after this step.</li></ol>`,54),p=[l];function i(r,c,h,d,u,y){return a(),e("div",null,p)}const C=s(t,[["render",i]]);export{F as __pageData,C as default};
